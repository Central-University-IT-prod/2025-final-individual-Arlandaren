# Внутренние сервисы

сервисы запускающиеся вместе в основным сервером для эффективного его взаимодействия

---

## nginx

- **Назначение:** Выполняет роль обратного прокси-сервера.
-**Для чего:** Принимает входящие HTTP-запросы, распределяет их по внутренним сервисам, выполняет балансировку нагрузки, SSL-терминацию и маршрутизацию запросов.
-**Особенности:**
- Использует кастомный конфигурационный файл `nginx.shield.conf`.
- Проброшенные порты: `8081` → `81` и `8082` → `82`.
- Зависит от сервиса `app_service`.

---

## redis

- **Назначение:** Хранение данных в оперативной памяти.
- **Для чего:** Используется для кэширования, хранения сессий и временных данных, что ускоряет работу приложения и снижает нагрузку на базу данных.
- **Особенности:**
    - Требует пароль, задаваемый через переменную `REDIS_PASSWORD`.
    - Проброшенный порт: `6378` → `6379`.

---

## postgres

-**Назначение:** Основаная база данных.
-**Для чего:** Хранит постоянные данные приложения (например, кампании, рекламодатели, клиенты).
-**Особенности:**
- Данные сохраняются в volume `pg_data` для обеспечения персистентности.
- Конфигурация через переменные: `POSTGRES_PASSWORD`, `POSTGRES_USER`, `POSTGRES_DB`.
- Проброшенный порт: `5434` → `5432`.

---

## app_service

- **Назначение:** Основной бэкенд-сервис приложения.
- **Для чего:** Обрабатывает бизнес-логику, принимает запросы пользователей, взаимодействует с базой данных, Redis и внешними API.
- **Особенности:**
    - Собирается из локального Dockerfile.
    - Экспонирует порты: `8080` и `9000`.
    - Зависит от сервисов `postgres` и `redis`.
    - Переменные окружения обеспечивают подключение к БД, к Redis и внешним API.

---

## prometheus

- **Назначение:** Система сбора и хранения метрик.
- **Для чего:** Мониторинг производительности сервисов, сбор метрик для дальнейшего анализа и визуализации.
- **Особенности:**
    - Конфигурация через локальный файл `prometheus.yml`.
    - Проброшенный порт: `9090`.

---

## grafana

- **Назначение:** Визуализация и анализ метрик.
- **Для чего:** Построение дашбордов и визуализация данных, собранных Prometheus, а также работа с логами через Loki.
- **Особенности:**
    - Использует локальные файлы для настройки: dashboards, datasources, provisioning.
    - Проброшенный порт: `3000`.
    - Зависит от сервисов `prometheus` и `loki`.

---

## nginx-exporter

- **Назначение:** Экспорт метрик прошедших запросов от сервера nginx.
- **Для чего:** Считывает метрики с nginx (например, статус, количество запросов) и передает их в Prometheus для мониторинга.
- **Особенности:**
    - Запрашивает данные по URL `http://nginx:82/nginx_status`.
    - Проброшенный порт: `9113`.

---

## loki

-**Назначение:** Централизованное хранилище логов.  
-**Для чего:** Индексирует и сохраняет логи, что позволяет выполнять поиск и анализ логов из разных сервисов.
-**Особенности:**
- Конфигурация через файл `loki-config.yaml`.
- Данные сохраняются в volume `loki-data`.
- Проброшенный порт: `3100`.

---

## promtail

-**Назначение:**Агент для сбора логов.
-**Для чего:**Считывает системные и контейнерные логи и отправляет их в Loki для их дальнейшего хранения и анализа.
-**Особенности:**
- Монтирует системные каталоги `/var/log`, Docker-контейнеры и Docker-сокет.
- Использует конфигурацию из `promtail-config.yaml`.

---

## bot

-**Назначение:** Телеграм-бот.
-**Для чего:** Автоматизация задач и оповещения, может отправлять уведомления о событиях в приложении, выполнять команды.
-**Особенности:**
- Собирается из Dockerfile, расположенного в директории `tg-bot`.
- Зависит от основного сервиса `app_service`.
### Использование
1. `открыть чат с ботом в телеграмме по username @rllllllt_the_best_test_task_bot`
2. `написать /start для начала работы с ботом и получения справочной информации`

---
## minio

-**Назначение:** s3 объектное хранилище.
-**Для чего:** Позволяет хранить и обрабатывать файлы на сервере.
-**Особенности:**
- Имеет WebUi на порту 9001.
### Использование
1. GoSDK github.com/minio/minio-go/v7

---